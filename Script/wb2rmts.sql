SQL> /
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  CREATE OR REPLACE PROCEDURE "MISAC99901"."WB2RMTS" is                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
	cursor c_br is select * from rm_inquiry_day_out@gwts where nvl(status,'N')<>'Y'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	cursor  d_br is select * from rm_inqry_resp_day_out@gwts where nvl(status,'N')<                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
>'Y';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	v_Rm_Inqry_num varchar2(12);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	v_rm_inqry_chk_sum varchar2(16);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
	v_rm_trans_icb varchar2(12);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
	v_errmsg varchar2(80);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
begin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
	for v_rec1 in c_br loop                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
		begin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
			begin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
				IF LENGTH(v_rec1.transaction_num)=12 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
					v_rm_trans_icb:=v_rec1.transaction_num;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
					select icb_tran_num into v_rm_trans_icb from gw_decomp_in where org_draft_n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
um=v_rec1.transaction_num;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
				END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
				insert into rm_receiving_day(DB_AMOUNT,CR_AMOUNT,RECEIVED_DATE,MODE_CODE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
					STATUS_CODE,TRANS_NUM,CREATED_DATE,BANKB_CODE)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				values(0,0,SYSDATE,'07','09',v_rec1.INQUIRY_NUM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
					v_rec1.CREATED_DATE,v_rec1.BANKB_CODE);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				insert into rm_inquiry_day(CREATED_DATE,BANKA_CODE,BANKB_CODE,EXT_BANKB_CODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
					USER_NAME,MANAGER_NAME,TRANSACTION_NUM,ORG_BILL_NUM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
					TRANSACTION_DATE,TRANSACTION_AMOUNT,INQUIRY_CONTENT,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
					SEC_CODE,VERIFIED_DATE,MODE_CODE,INQUIRY_NUM,CHK_SUM)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
				select CREATED_DATE,BANKA_CODE,BANKB_CODE,EXT_BANKB_CODE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
					USER_NAME,MANAGER_NAME,v_rm_trans_icb,ORG_BILL_NUM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
					TRANSACTION_DATE,TRANSACTION_AMOUNT,INQUIRY_CONTENT,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
					SEC_CODE,VERIFIED_DATE,MODE_CODE,INQUIRY_NUM,CHK_SUM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
				From rm_inquiry_day_out@gwts a where a.INQUIRY_NUM= v_rec1.INQUIRY_NUM ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				select rm_inqry_check_sum(2,v_rec1.INQUIRY_NUM) into v_rm_inqry_chk_sum from                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 dual;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
				update rm_inquiry_day set chk_sum=v_rm_inqry_chk_sum where INQUIRY_NUM= v_re                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
c1.INQUIRY_NUM;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
				update rm_inquiry_day_out@gwts set status='Y' where INQUIRY_NUM= v_rec1.INQU                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
IRY_NUM;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
				commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
			exception when others then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
				v_errmsg:=substr(SQLERRM,1,80);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				dbms_output.put_line(v_errmsg);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				null;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
			end;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
		end;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	end loop;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
	for v_rec2 in d_br loop                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
		begin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
			begin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
				IF LENGTH(v_rec2.transaction_num)=12 THEN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
					v_rm_trans_icb:=v_rec2.transaction_num;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				ELSE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
					select icb_tran_num into v_rm_trans_icb from gw_decomp_in where org_draft_n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
um=v_rec2.transaction_num;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
				END IF;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
				insert into rm_receiving_day(DB_AMOUNT,CR_AMOUNT,RECEIVED_DATE,MODE_CODE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
					STATUS_CODE,TRANS_NUM,CREATED_DATE,BANKB_CODE)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				values(0,0,SYSDATE,'07','09',v_rec2.INQRY_RESP_NUM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
					v_rec2.CREATED_DATE,v_rec2.BANKB_CODE);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				insert into rm_inquiry_day(CREATED_DATE,BANKA_CODE,BANKB_CODE,EXT_BANKB_CODE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
					USER_NAME,TRANSACTION_NUM,ORG_BILL_NUM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
					TRANSACTION_DATE,TRANSACTION_AMOUNT,INQUIRY_CONTENT,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
					SEC_CODE,VERIFIED_DATE,MODE_CODE,INQUIRY_NUM,CHK_SUM)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
				select CONFIRM_DATE,BANKA_CODE,BANKB_CODE,EXT_BANKB_CODE,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
					CONFIRM_USER,v_rm_trans_icb,ORG_BILL_NUM,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
					TRANSACTION_DATE,TRANSACTION_AMOUNT,CONFIRM_CONTENT,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
					SEC_CODE,VERIFIED_DATE,MODE_CODE,INQRY_RESP_NUM,CHK_SUM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
				From rm_inqry_resp_day_out@gwts a where a.inqry_resp_num= v_rec2.INQRY_RESP_                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
NUM;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
				select rm_inqry_check_sum(2,v_rec2.INQRY_RESP_NUM) into v_rm_inqry_chk_sum f                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
rom dual;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
				update rm_inquiry_day set chk_sum=v_rm_inqry_chk_sum where INQUIRY_NUM= v_re                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
c2.inqry_resp_num;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
				update rm_inqry_resp_day_out@gwts set status='Y' where inqry_resp_num= v_rec                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
2.INQRY_RESP_NUM;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
				commit;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
			exception when others then                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
				v_errmsg:=substr(SQLERRM,1,80);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				dbms_output.put_line(v_errmsg);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
				null;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
			end;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
		end;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
	end loop;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
end;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

SQL> spool off
